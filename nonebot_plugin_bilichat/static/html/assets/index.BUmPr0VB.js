import{aD as e,m as a,n as o,r as t,ao as s,aE as n,aF as l,ai as i,aG as r,aH as c,al as u,a2 as d,a7 as m,aj as f,ak as p,j as h,F as g,aI as v,an as w,M as y,U as k,S as _,aJ as b,aK as C,am as S,aL as T,aM as x}from"./vendor.cCBPk__2.js";import{J as V,K as P}from"./utils.B4jMxAnu.js";import{X as F,T as $,R as I,j,$ as N}from"./vjsf-vendor.Bvzdyhxd.js";import{S as U,N as L,a as D,b as G,u as B,c as O,d as M,e as q,f as z,l as A,z as H,g as J,h as R,i as E,B as K,j as X,k as Q,m as W,n as Y,o as Z}from"./naive-ui-vendor.Dy4dmAY1.js";import{l as ee}from"./lodash-vendor.DMIDq1rY.js";import{e as ae}from"./vue-vendor.DUSQ37nN.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const oe={success:e=>{const a=se();return a.token&&(e.headers.Authorization=`Bearer ${a.token}`),e},error:e=>Promise.reject(e)},te=new V({baseURL:window.location.href.split("/index.html")[0],timeout:1e4},[oe],[P]),se=e("global",{state:()=>({token:"",hasToken:!0,isGetConfigSchema:!1,botConfig:{},schema:{},isSaving:!1}),actions:{setToken(e){this.token=e,window.localStorage.setItem("bilichatToken",e)},getToken(){this.token=window.localStorage.getItem("bilichatToken")||"",this.hasToken=!!this.token},removeToken(){this.token="",window.localStorage.removeItem("token")}}}),ne=e("config",{state:()=>({isGetConfigSchema:!1,config:{},configSchema:{},prevConfig:{},isSaving:!1}),actions:{tempUpdateConfig(e){this.config=e},rollbackConfig(){window.$message.info("已经重置到上一次保存的配置"),this.config=this.prevConfig},async getConfigSchema(){const e=se(),{status:a,data:o}=await async function(){return await te.get("/config/schema")}();200===a?(delete o.$defs.UP.properties.dynamic.additionalProperties,delete o.$defs.UP.properties.dynamic.propertyNames,this.configSchema=o,e.hasToken=!0,this.isGetConfigSchema=!0,window.$message.success("获取配置数据成功")):403===a||401===a?(window.$message.error("Token验证失败"),e.removeToken(),e.hasToken=!1):window.$message.error("获取配置数据失败")},async getBotConfig(){const e=se(),{status:a,data:o}=await async function(){return await te.get("/config")}();200===a?(this.config=o,this.prevConfig=o,e.hasToken=!0):403===a||401===a?(window.$message.error("Token验证失败"),e.removeToken(),e.hasToken=!1):window.$message.error("获取配置数据失败")},async saveBotConfig(){if(this.isSaving)return;const e=window.$message.loading("保存中...",{duration:0}),a=se(),{status:o,data:t}=await async function(e){return await te.post("/config",e)}(this.config);200===o?(e.type="success",e.content="保存成功",setTimeout((()=>{e.destroy()}),2e3),this.config=t,this.prevConfig=t,a.hasToken=!0):403!==o&&401!==o||(window.$message.error("Token验证失败"),a.removeToken(),a.hasToken=!1)}}}),le=(e,a)=>{const o=e.__vccOpts||e;for(const[t,s]of a)o[t]=s;return o},ie=le(a({__name:"UserInfo",props:F,setup(e){const a=e,m=o((()=>$.getPathVal(a.rootFormData,a.curNodePath))),f=t(!1);return(e,a)=>(s(),n("div",{class:d(["info-codeblock",{"is-expanded":f.value}])},[l("div",{class:"expand-toggle",onClick:a[0]||(a[0]=e=>f.value=!f.value)},a[1]||(a[1]=[l("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 320 512"},[l("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4l96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z",fill:"currentColor"})],-1)])),i(c(L),{class:"codeblock","theme-overrides":{Scrollbar:{height:"8px",width:"0",railInsetHorizontal:"4px 4px 4px auto",borderRadius:"2px",color:"#e3e3e3aa",colorHover:"#e3e3e3"}}},{default:r((()=>[i(c(U),{"x-scrollable":""},{default:r((()=>[l("pre",null,u(JSON.stringify(m.value,null,2)),1)])),_:1})])),_:1})],2))}}),[["__scopeId","data-v-206661a6"]]),re={class:"btns",style:{display:"flex","justify-content":"end"}},ce=le(a({__name:"DynamicConfig",props:{modelValue:{type:Object,default:()=>({})},dynamicType:Array,pushType:Array},emits:["update:modelValue","close"],setup(e,{emit:a}){const o=e,t=a,u=m({...o.modelValue}),d=()=>{t("update:modelValue",u),t("close")};return(e,a)=>{const m=f("n-select"),w=f("n-form-item"),y=f("n-form"),k=f("n-button");return s(),p(c(D),{class:"dynamic-config",title:"动态配置",bordered:!1,role:"dialog"},{footer:r((()=>[l("div",re,[i(k,{style:{"margin-right":"1rem"},onClick:a[0]||(a[0]=e=>t("close"))},{default:r((()=>a[1]||(a[1]=[h("取消")]))),_:1}),i(k,{type:"primary",onClick:d},{default:r((()=>a[2]||(a[2]=[h("确定")]))),_:1})])])),default:r((()=>[i(c(U),{style:{"max-height":"calc(90vh - 160px)","min-height":"300px",padding:"1rem"}},{default:r((()=>[l("div",null,[i(y,{"label-width":"auto"},{default:r((()=>[(s(!0),n(g,null,v(o.dynamicType,(e=>(s(),p(w,{label:e},{default:r((()=>[i(m,{value:u[e],"onUpdate:value":a=>u[e]=a,options:o.pushType.map((e=>({label:e,value:e})))},null,8,["value","onUpdate:value","options"])])),_:2},1032,["label"])))),256))])),_:1})])])),_:1})])),_:1})}}}),[["__scopeId","data-v-19a2b64f"]]),ue={class:"n-form-item-label n-form-item-label--right-mark"},de={class:"n-form-item-label__text"},me={class:"genFormLabel"},fe={style:{width:"100%"}},pe=a({__name:"Dynamic",props:F,setup(e){const a=e,n=o({get:()=>$.getPathVal(a.rootFormData,a.curNodePath),set(e){$.setPathVal(a.rootFormData,a.curNodePath,e)}});n.value=a.schema.default;const d=t(!1);return(e,o)=>{const t=f("n-button"),m=f("n-form-item");return s(),p(m,null,{default:r((()=>[w(e.$slots,"label",{},(()=>[l("label",ue,[l("span",de,[l("span",me,u(a.schema.title)+"：",1)])])])),l("div",fe,[i(t,{style:{"background-color":"#fff"},onClick:o[0]||(o[0]=e=>d.value=!0)},{default:r((()=>o[4]||(o[4]=[h("修改")]))),_:1})]),i(c(G),{show:d.value,"onUpdate:show":o[3]||(o[3]=e=>d.value=e)},{default:r((()=>[i(ce,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value=e),dynamicType:a.rootSchema.$defs.DynamicType.enum,pushType:a.rootSchema.$defs.PushType.enum,onClose:o[2]||(o[2]=e=>d.value=!1)},null,8,["modelValue","dynamicType","pushType"])])),_:1},8,["show"])])),_:3})}}}),he={class:"item-wrap"},ge=le(a({name:"ListItem",__name:"ListItem",props:{schema:{},uiSchema:{},errorSchema:{},customFormats:{},rootSchema:{},rootFormData:{},curNodePath:{},required:{},needValidFieldGroup:{}},setup(e){const a=e,r=t(!1),u=o((()=>{const{"ui:field":e,...o}=a.uiSchema;return{globalOptions:I,schema:a.schema,uiSchema:o,errorSchema:a.errorSchema,customRule:({callback:e})=>e(),customFormats:a.customFormats,rootSchema:a.rootSchema,rootFormData:a.rootFormData,curNodePath:a.curNodePath,required:a.required,needValidFieldGroup:a.needValidFieldGroup}}));return(e,a)=>(s(),n("div",{class:d(["list-item",{expanded:r.value}])},[l("div",{class:"expand-toggle",onClick:a[0]||(a[0]=e=>r.value=!r.value)},a[1]||(a[1]=[l("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 320 512"},[l("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4l96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z",fill:"currentColor"})],-1)])),l("div",he,[i(c(j),y({class:"content"},u.value),null,16)])],2))}}),[["__scopeId","data-v-79c300ac"]]),ve=a({__name:"ConfigForm",setup(e){const a=ne(),o=B();a.getBotConfig();const t={api:{request_api:{items:{"ui:field":ge}}},subs:{users:{"ui:options":{addable:!1},items:{"ui:field":ge,info:{"ui:field":ie},subscribes:{items:{"ui:field":ge,dynamic:{"ui:field":pe}}}}}}};return(e,n)=>{const l=f("vue-form");return s(),p(l,{modelValue:c(a).config,"onUpdate:modelValue":n[0]||(n[0]=e=>c(a).config=e),schema:c(a).configSchema,"ui-schema":t,onSubmit:c(a).saveBotConfig,onCancel:c(a).rollbackConfig,onValidationFailed:n[1]||(n[1]=e=>c(o).error("表单验证失败，请检查"))},null,8,["modelValue","schema","onSubmit","onCancel"])}}}),we={class:"loading"},ye=le(a({__name:"GlobalLoading",setup(e){const a=ne();return(e,o)=>k((s(),n("div",we,o[0]||(o[0]=[l("div",{class:"spinner-border text-light",role:"status"},[l("span",{class:"visually-hidden"},"Loading...")],-1)]),512)),[[_,!c(a).isGetConfigSchema]])}}),[["__scopeId","data-v-7b7ee6ae"]]),ke=le(a({__name:"TokenDialog",setup(e){const a=se(),o=ne(),n=t(""),l=()=>{a.setToken(n.value),o.getConfigSchema()};return(e,a)=>(s(),p(c(q),{title:"Token验证","positive-text":"确认","show-icon":!1,closable:!1,class:"token-dialog",onPositiveClick:l},{default:r((()=>[i(c(M),{vertical:""},{default:r((()=>[i(c(O),{value:n.value,"onUpdate:value":a[0]||(a[0]=e=>n.value=e),placeholder:"请输入token",type:"password"},null,8,["value"])])),_:1})])),_:1}))}}),[["__scopeId","data-v-a87a20a4"]]),_e=a({__name:"CodeEditor",setup(e){const a=ne(),t=[b(),C()],n=o({get:()=>JSON.stringify(a.config,null,2),set(e){l(e)}}),l=ee.debounce((e=>{const o=function(e){try{return JSON.parse(e)}catch(a){return window.$message.error("配置文件格式错误"),!1}}(e);o&&a.tempUpdateConfig(o)}),500);return(e,a)=>{const o=f("codemirror");return s(),p(o,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),style:{flexShrink:0,width:"100%",overflowX:"hidden",minHeight:"300px"},extensions:t,onChange:c(l)},null,8,["modelValue","onChange"])}}}),be={class:"container"},Ce={class:"sections"},Se=le(a({__name:"MainPage",setup(e){window.$message=B();const a=se(),o=ne();return a.getToken(),o.getConfigSchema(),(e,t)=>(s(),n("div",be,[i(ye),t[0]||(t[0]=l("header",null,[l("span",null,"BiliChat")],-1)),i(c(z),null,{default:r((()=>[l("main",null,[l("div",Ce,[l("section",null,[c(o).isGetConfigSchema?(s(),p(_e,{key:0})):S("",!0)]),l("section",null,[c(o).isGetConfigSchema?(s(),p(ve,{key:0})):S("",!0)])])]),c(a).hasToken?S("",!0):(s(),p(ke,{key:0}))])),_:1})]))}}),[["__scopeId","data-v-635cc600"]]),Te=a({__name:"App",setup(e){const a=(()=>{const e=A;return e.common.primaryColor="#05abffff",e.common.primaryColorHover="#05bcffff",e.common.primaryColorPressed="#059affff",e.common.primaryColorSuppl="#0589ffff",e})();return(e,o)=>(s(),p(c(L),{locale:c(H),"date-locale":c(J),theme:c(a)},{default:r((()=>[i(c(R),null,{default:r((()=>[i(Se)])),_:1})])),_:1},8,["locale","date-locale","theme"]))}}),xe=E({components:[K,O,X,Q,W,Y,Z]}),Ve=T(Te);Ve.component("VueForm",N),Ve.use(ae),Ve.use(xe),Ve.use(x()),Ve.mount("#app");
