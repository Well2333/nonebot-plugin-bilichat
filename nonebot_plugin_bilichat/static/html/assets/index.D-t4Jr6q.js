import{d as $,b as g,u as S,r as y,c as G,o as l,e as d,f as i,w as V,v as A,g as I,h as m,i as v,j as f,N as L,k as F,l as N,m as T,n as O,p as x,z as B,q as U,s as j,t as q,$ as z,x as D,y as E,B as H,A as M,C as K,D as R,E as J,F as Q}from"./vendor.CRBq5BKZ.js";import{H as W,b as X}from"./utils.CBXTS7j5.js";(function(){const o=document.createElement("link").relList;if(!(o&&o.supports&&o.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const e=function(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}(t);fetch(t.href,e)}})();const u=$("global",{state:()=>({token:"",hasToken:!0,isGetConfigSchema:!1,schema:{}}),actions:{setToken(o){this.token=o,window.localStorage.setItem("bilichatToken",o)},getToken(){this.token=window.localStorage.getItem("bilichatToken")||"",this.hasToken=!!this.token},removeToken(){this.token="",window.localStorage.removeItem("token")},async getConfigSchema(){const{status:o,data:a}=await C.getConfigSchema();o===200?(this.schema=a,this.hasToken=!0,this.isGetConfigSchema=!0):o===403||o===401?(window.$message.error("Token验证失败"),this.removeToken(),this.hasToken=!1):window.$message.error("获取配置数据失败")}}}),Y={success:o=>{const a=u();return a.token&&(o.headers.Authorization=`Bearer ${a.token}`),o},error:o=>Promise.reject(o)},w=new W({baseURL:`${window.location.protocol}//${window.location.host}/bilichatwebui`,timeout:1e4},[Y],[X]),C={getConfigSchema:async function(){return await w.get("/config/schema")},getConfig:async function(){return await w.get("/config")},saveConfig:async function(o){return await w.post("/config",o)}},Z=g({__name:"ConfigForm",setup(o){const a=u(),t=S(),e=y({});let n={};const s=y(!1);async function k(){if(s.value)return;const r=t.loading("保存中...",{duration:0});s.value=!0;const{status:c,data:h}=await C.saveConfig(e.value);c===200?(r.type="success",r.content="保存成功",setTimeout(()=>{r.destroy()},2e3),e.value=h,n=h):(r.type="error",r.content="保存失败",setTimeout(()=>{r.destroy()},2e3)),s.value=!1}function P(){e.value=n,t.info("已移除修改")}return async function(){const{status:r,data:c}=await C.getConfig();r===200?(e.value=c,n=c,t.info("已加载bot配置")):t.error("获取配置失败")}(),(r,c)=>{const h=G("vue-form");return l(),d(h,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=b=>e.value=b),schema:i(a).schema,onSubmit:k,onCancel:P,onValidationFailed:c[1]||(c[1]=b=>i(t).error("表单验证失败，请检查"))},null,8,["modelValue","schema"])}}}),ee={class:"loading"},_=(o,a)=>{const t=o.__vccOpts||o;for(const[e,n]of a)t[e]=n;return t},oe=_(g({__name:"GlobalLoading",setup(o){const a=u();return(t,e)=>V((l(),I("div",ee,e[0]||(e[0]=[m("div",{class:"spinner-border text-light",role:"status"},[m("span",{class:"visually-hidden"},"Loading...")],-1)]),512)),[[A,!i(a).isGetConfigSchema]])}}),[["__scopeId","data-v-d1a014a4"]]),te=_(g({__name:"TokenDialog",setup(o){const a=u(),t=y(""),e=()=>{a.setToken(t.value),a.getConfigSchema()};return(n,s)=>(l(),d(i(N),{title:"Token验证","positive-text":"确认","show-icon":!1,closable:!1,class:"token-dialog",onPositiveClick:e},{default:v(()=>[f(i(F),{vertical:""},{default:v(()=>[f(i(L),{value:t.value,"onUpdate:value":s[0]||(s[0]=k=>t.value=k),placeholder:"请输入token",type:"password"},null,8,["value"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-5a66f0dc"]]),ae={class:"container"},ne=_(g({__name:"MainPage",setup(o){window.$message=S();const a=u();return(t,e)=>(l(),I("div",ae,[f(oe),e[0]||(e[0]=m("header",null,[m("span",null,"BiliChat")],-1)),m("main",null,[i(a).isGetConfigSchema?(l(),d(Z,{key:0})):T("",!0)]),i(a).hasToken?T("",!0):(l(),d(te,{key:0}))]))}}),[["__scopeId","data-v-6497635e"]]),se=g({__name:"App",setup(o){const a=u();a.getToken(),a.getConfigSchema();const t=(()=>{const e=O;return e.common.primaryColor="#05abffff",e.common.primaryColorHover="#05bcffff",e.common.primaryColorPressed="#059affff",e.common.primaryColorSuppl="#0589ffff",e})();return(e,n)=>(l(),d(i(j),{locale:i(B),"date-locale":i(U),theme:i(t)},{default:v(()=>[f(i(x),null,{default:v(()=>[f(ne)]),_:1})]),_:1},8,["locale","date-locale","theme"]))}}),ie=E({components:[H,L,M,K,R,J,Q]}),p=q(se);p.component("VueForm",z),p.use(ie),p.use(D()),p.mount("#app");
