import{aD as e,s as a,m as o,n as t,r as s,ao as n,aE as i,aF as l,ai as r,aG as c,aH as u,al as d,a2 as m,a7 as f,aj as p,ak as g,j as h,F as v,aI as y,an as k,U as w,S as _,aJ as b,aK as C,am as T,aL as S,aM as x}from"./vendor.cCBPk__2.js";import{J as V,K as P}from"./utils.B4jMxAnu.js";import{X as $,T as U,$ as j}from"./vjsf-vendor.BLy33ZKn.js";import{S as I,N,a as L,b as F,u as B,c as D,d as G,e as O,f as A,l as H,z as J,g as z,h as M,i as E,B as K,j as R,k as X,m as q,n as Q,o as W}from"./naive-ui-vendor.Dy4dmAY1.js";import{l as Y}from"./lodash-vendor.DMIDq1rY.js";import{e as Z}from"./vue-vendor.DUSQ37nN.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?a.credentials="include":"anonymous"===e.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const ee={success:e=>{const a=oe();return a.token&&(e.headers.Authorization=`Bearer ${a.token}`),e},error:e=>Promise.reject(e)},ae=new V({baseURL:window.location.href.split("/index.html")[0],timeout:1e4},[ee],[P]),oe=e("global",{state:()=>({token:"",hasToken:!0,isGetConfigSchema:!1,botConfig:{},schema:{},isSaving:!1}),actions:{setToken(e){this.token=e,window.localStorage.setItem("bilichatToken",e)},getToken(){this.token=window.localStorage.getItem("bilichatToken")||"",this.hasToken=!!this.token},removeToken(){this.token="",window.localStorage.removeItem("token")}}}),te=e("config",{state:()=>({isGetConfigSchema:!1,config:{},configSchema:{},prevConfig:{},isSaving:!1}),actions:{tempUpdateConfig(e){this.config=e},rollbackConfig(){window.$message.info("已经重置到上一次保存的配置"),this.config=this.prevConfig},async getConfigSchema(){const e=oe(),{status:a,data:o}=await async function(){return await ae.get("/config/schema")}();200===a?(delete o.$defs.UP.properties.dynamic.additionalProperties,delete o.$defs.UP.properties.dynamic.propertyNames,this.configSchema=o,e.hasToken=!0,this.isGetConfigSchema=!0,window.$message.success("获取配置数据成功")):403===a||401===a?(window.$message.error("Token验证失败"),e.removeToken(),e.hasToken=!1):window.$message.error("获取配置数据失败")},async getBotConfig(){const e=oe(),{status:o,data:t}=await async function(){return await ae.get("/config")}();200===o?(this.config=t,this.prevConfig=a(t),e.hasToken=!0):403===o||401===o?(window.$message.error("Token验证失败"),e.removeToken(),e.hasToken=!1):window.$message.error("获取配置数据失败")},async saveBotConfig(){if(this.isSaving)return;const e=window.$message.loading("保存中...",{duration:0}),o=oe(),{status:t,data:s}=await async function(e){return await ae.post("/config",e)}(this.config);200===t?(e.type="success",e.content="保存成功",setTimeout((()=>{e.destroy()}),2e3),this.config=s,this.prevConfig=a(s),o.hasToken=!0):403!==t&&401!==t||(window.$message.error("Token验证失败"),o.removeToken(),o.hasToken=!1)}}}),se=(e,a)=>{const o=e.__vccOpts||e;for(const[t,s]of a)o[t]=s;return o},ne=se(o({__name:"UserInfo",props:$,setup(e){const a=e,o=t((()=>U.getPathVal(a.rootFormData,a.curNodePath))),f=s(!1);return(e,a)=>(n(),i("div",{class:m(["info-codeblock",{"is-expanded":f.value}])},[l("div",{class:"expand-toggle",onClick:a[0]||(a[0]=e=>f.value=!f.value)},a[1]||(a[1]=[l("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 320 512"},[l("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4l96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z",fill:"currentColor"})],-1)])),r(u(N),{class:"codeblock","theme-overrides":{Scrollbar:{height:"8px",width:"0",railInsetHorizontal:"4px 4px 4px auto",borderRadius:"2px",color:"#e3e3e3aa",colorHover:"#e3e3e3"}}},{default:c((()=>[r(u(I),{"x-scrollable":""},{default:c((()=>[l("pre",null,d(JSON.stringify(o.value,null,2)),1)])),_:1})])),_:1})],2))}}),[["__scopeId","data-v-206661a6"]]),ie={class:"btns",style:{display:"flex","justify-content":"end"}},le=se(o({__name:"DynamicConfig",props:{modelValue:{type:Object,default:()=>({})},dynamicType:Array,pushType:Array},emits:["update:modelValue","close"],setup(e,{emit:a}){const o=e,t=a,s=f({...o.modelValue}),d=()=>{t("update:modelValue",s),t("close")};return(e,a)=>{const m=p("n-select"),f=p("n-form-item"),k=p("n-form"),w=p("n-button");return n(),g(u(L),{class:"dynamic-config",title:"动态配置",bordered:!1,role:"dialog"},{footer:c((()=>[l("div",ie,[r(w,{style:{"margin-right":"1rem"},onClick:a[0]||(a[0]=e=>t("close"))},{default:c((()=>a[1]||(a[1]=[h("取消")]))),_:1}),r(w,{type:"primary",onClick:d},{default:c((()=>a[2]||(a[2]=[h("确定")]))),_:1})])])),default:c((()=>[r(u(I),{style:{"max-height":"calc(90vh - 160px)","min-height":"300px",padding:"1rem"}},{default:c((()=>[l("div",null,[r(k,{"label-width":"auto"},{default:c((()=>[(n(!0),i(v,null,y(o.dynamicType,(e=>(n(),g(f,{label:e},{default:c((()=>[r(m,{value:s[e],"onUpdate:value":a=>s[e]=a,options:o.pushType.map((e=>({label:e,value:e})))},null,8,["value","onUpdate:value","options"])])),_:2},1032,["label"])))),256))])),_:1})])])),_:1})])),_:1})}}}),[["__scopeId","data-v-19a2b64f"]]),re={class:"n-form-item-label n-form-item-label--right-mark"},ce={class:"n-form-item-label__text"},ue={class:"genFormLabel"},de={style:{width:"100%"}},me=o({__name:"Dynamic",props:$,setup(e){const a=e,o=t({get:()=>U.getPathVal(a.rootFormData,a.curNodePath),set(e){U.setPathVal(a.rootFormData,a.curNodePath,e)}});o.value=a.schema.default;const i=s(!1);return(e,t)=>{const s=p("n-button"),m=p("n-form-item");return n(),g(m,null,{default:c((()=>[k(e.$slots,"label",{},(()=>[l("label",re,[l("span",ce,[l("span",ue,d(a.schema.title)+"：",1)])])])),l("div",de,[r(s,{style:{"background-color":"#fff"},onClick:t[0]||(t[0]=e=>i.value=!0)},{default:c((()=>t[4]||(t[4]=[h("修改")]))),_:1})]),r(u(F),{show:i.value,"onUpdate:show":t[3]||(t[3]=e=>i.value=e)},{default:c((()=>[r(le,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),dynamicType:a.rootSchema.$defs.DynamicType.enum,pushType:a.rootSchema.$defs.PushType.enum,onClose:t[2]||(t[2]=e=>i.value=!1)},null,8,["modelValue","dynamicType","pushType"])])),_:1},8,["show"])])),_:3})}}}),fe=o({__name:"ConfigForm",setup(e){const a=te(),o=B();a.getBotConfig();const t={subs:{users:{"ui:options":{addable:!1},items:{info:{"ui:field":ne},subscribes:{items:{dynamic:{"ui:field":me}}}}}}};return(e,s)=>{const i=p("vue-form");return n(),g(i,{modelValue:u(a).config,"onUpdate:modelValue":s[0]||(s[0]=e=>u(a).config=e),schema:u(a).configSchema,"ui-schema":t,onSubmit:u(a).saveBotConfig,onCancel:u(a).rollbackConfig,onValidationFailed:s[1]||(s[1]=e=>u(o).error("表单验证失败，请检查"))},null,8,["modelValue","schema","onSubmit","onCancel"])}}}),pe={class:"loading"},ge=se(o({__name:"GlobalLoading",setup(e){const a=te();return(e,o)=>w((n(),i("div",pe,o[0]||(o[0]=[l("div",{class:"spinner-border text-light",role:"status"},[l("span",{class:"visually-hidden"},"Loading...")],-1)]),512)),[[_,!u(a).isGetConfigSchema]])}}),[["__scopeId","data-v-7b7ee6ae"]]),he=se(o({__name:"TokenDialog",setup(e){const a=oe(),o=te(),t=s(""),i=()=>{a.setToken(t.value),o.getConfigSchema()};return(e,a)=>(n(),g(u(O),{title:"Token验证","positive-text":"确认","show-icon":!1,closable:!1,class:"token-dialog",onPositiveClick:i},{default:c((()=>[r(u(G),{vertical:""},{default:c((()=>[r(u(D),{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),placeholder:"请输入token",type:"password"},null,8,["value"])])),_:1})])),_:1}))}}),[["__scopeId","data-v-ddbd1aa1"]]),ve=o({__name:"CodeEditor",setup(e){const a=te(),o=[b(),C()],s=t({get:()=>JSON.stringify(a.config,null,2),set(e){i(e)}}),i=Y.debounce((e=>{const o=function(e){try{return JSON.parse(e)}catch(a){return window.$message.error("配置文件格式错误"),!1}}(e);o&&a.tempUpdateConfig(o)}),500);return(e,a)=>{const t=p("codemirror");return n(),g(t,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),style:{flexShrink:0,width:"100%",overflowX:"hidden",minHeight:"300px"},extensions:o,onChange:u(i)},null,8,["modelValue","onChange"])}}}),ye={class:"container"},ke={class:"sections"},we=se(o({__name:"MainPage",setup(e){window.$message=B();const a=oe(),o=te();return a.getToken(),o.getConfigSchema(),(e,t)=>(n(),i("div",ye,[r(ge),t[0]||(t[0]=l("header",null,[l("span",null,"BiliChat")],-1)),r(u(A),null,{default:c((()=>[l("main",null,[l("div",ke,[l("section",null,[u(o).isGetConfigSchema?(n(),g(ve,{key:0})):T("",!0)]),l("section",null,[u(o).isGetConfigSchema?(n(),g(fe,{key:0})):T("",!0)])])]),u(a).hasToken?T("",!0):(n(),g(he,{key:0}))])),_:1})]))}}),[["__scopeId","data-v-3f63c8a9"]]),_e=o({__name:"App",setup(e){const a=(()=>{const e=H;return e.common.primaryColor="#05abffff",e.common.primaryColorHover="#05bcffff",e.common.primaryColorPressed="#059affff",e.common.primaryColorSuppl="#0589ffff",e})();return(e,o)=>(n(),g(u(N),{locale:u(J),"date-locale":u(z),theme:u(a)},{default:c((()=>[r(u(M),null,{default:c((()=>[r(we)])),_:1})])),_:1},8,["locale","date-locale","theme"]))}}),be=E({components:[K,D,R,X,q,Q,W]}),Ce=S(_e);Ce.component("VueForm",j),Ce.use(Z),Ce.use(be),Ce.use(x()),Ce.mount("#app");
