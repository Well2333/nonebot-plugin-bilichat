import{d as e,b as o,u as t,r as a,c as n,o as s,e as i,f as r,w as c,v as l,g as u,h as m,i as d,j as f,N as g,k as h,l as p,m as v,n as k,p as y,z as w,q as C,s as _,t as T,$ as b,x as S,y as I,B as L,A as P,C as G,D as V,E as $,F as j}from"./vendor.XuBSy0Y2.js";import{H as x,b as A}from"./utils.CTQ8OqS_.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&o(e)})).observe(document,{childList:!0,subtree:!0})}function o(e){if(e.ep)return;e.ep=!0;const o=function(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?o.credentials="include":"anonymous"===e.crossOrigin?o.credentials="omit":o.credentials="same-origin",o}(e);fetch(e.href,o)}}();const F=e("global",{state:()=>({token:"",hasToken:!0,isGetConfigSchema:!1,schema:{}}),actions:{setToken(e){this.token=e,window.localStorage.setItem("bilichatToken",e)},getToken(){this.token=window.localStorage.getItem("bilichatToken")||"",this.hasToken=!!this.token},removeToken(){this.token="",window.localStorage.removeItem("token")},async getConfigSchema(){const{status:e,data:o}=await B.getConfigSchema();200===e?(this.schema=o,this.hasToken=!0,this.isGetConfigSchema=!0):403===e||401===e?(window.$message.error("Token验证失败"),this.removeToken(),this.hasToken=!1):window.$message.error("获取配置数据失败")}}}),N={success:e=>{const o=F();return o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e},error:e=>Promise.reject(e)},O=new x({baseURL:window.location.href.split("/index.html")[0],timeout:1e4},[N],[A]),B={getConfigSchema:async function(){return await O.get("/config/schema")},getConfig:async function(){return await O.get("/config")},saveConfig:async function(e){return await O.post("/config",e)}},U=o({__name:"ConfigForm",setup(e){const o=F(),c=t(),l=a({});let u={};const m=a(!1);async function d(){if(m.value)return;const e=c.loading("保存中...",{duration:0});m.value=!0;const{status:o,data:t}=await B.saveConfig(l.value);200===o?(e.type="success",e.content="保存成功",setTimeout((()=>{e.destroy()}),2e3),l.value=t,u=t):(e.type="error",e.content="保存失败",setTimeout((()=>{e.destroy()}),2e3)),m.value=!1}function f(){l.value=u,c.info("已移除修改")}return async function(){const{status:e,data:o}=await B.getConfig();200===e?(l.value=o,u=o,c.info("已加载bot配置")):c.error("获取配置失败")}(),(e,t)=>{const a=n("vue-form");return s(),i(a,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),schema:r(o).schema,onSubmit:d,onCancel:f,onValidationFailed:t[1]||(t[1]=e=>r(c).error("表单验证失败，请检查"))},null,8,["modelValue","schema"])}}}),q={class:"loading"},z=(e,o)=>{const t=e.__vccOpts||e;for(const[a,n]of o)t[a]=n;return t},D=z(o({__name:"GlobalLoading",setup(e){const o=F();return(e,t)=>c((s(),u("div",q,t[0]||(t[0]=[m("div",{class:"spinner-border text-light",role:"status"},[m("span",{class:"visually-hidden"},"Loading...")],-1)]),512)),[[l,!r(o).isGetConfigSchema]])}}),[["__scopeId","data-v-d1a014a4"]]),E=z(o({__name:"TokenDialog",setup(e){const o=F(),t=a(""),n=()=>{o.setToken(t.value),o.getConfigSchema()};return(e,o)=>(s(),i(r(p),{title:"Token验证","positive-text":"确认","show-icon":!1,closable:!1,class:"token-dialog",onPositiveClick:n},{default:d((()=>[f(r(h),{vertical:""},{default:d((()=>[f(r(g),{value:t.value,"onUpdate:value":o[0]||(o[0]=e=>t.value=e),placeholder:"请输入token",type:"password"},null,8,["value"])])),_:1})])),_:1}))}}),[["__scopeId","data-v-5a66f0dc"]]),H={class:"container"},M=z(o({__name:"MainPage",setup(e){window.$message=t();const o=F();return(e,t)=>(s(),u("div",H,[f(D),t[0]||(t[0]=m("header",null,[m("span",null,"BiliChat")],-1)),m("main",null,[r(o).isGetConfigSchema?(s(),i(U,{key:0})):v("",!0)]),r(o).hasToken?v("",!0):(s(),i(E,{key:0}))]))}}),[["__scopeId","data-v-6497635e"]]),K=o({__name:"App",setup(e){const o=F();o.getToken(),o.getConfigSchema();const t=(()=>{const e=k;return e.common.primaryColor="#05abffff",e.common.primaryColorHover="#05bcffff",e.common.primaryColorPressed="#059affff",e.common.primaryColorSuppl="#0589ffff",e})();return(e,o)=>(s(),i(r(_),{locale:r(w),"date-locale":r(C),theme:r(t)},{default:d((()=>[f(r(y),null,{default:d((()=>[f(M)])),_:1})])),_:1},8,["locale","date-locale","theme"]))}}),R=I({components:[L,g,P,G,V,$,j]}),J=T(K);J.component("VueForm",b),J.use(R),J.use(S()),J.mount("#app");
